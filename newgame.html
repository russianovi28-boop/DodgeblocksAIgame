<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dodge Blocks - Simple Working Game</title>
<style>
  body, html {
    margin: 0; padding: 0; height: 100%; overflow: hidden;
    background: linear-gradient(135deg, #667eea, #764ba2);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: white;
    display: flex; justify-content: center; align-items: center;
  }
  #game-container {
    position: relative;
    width: 95vw; height: 90vh;
    background: #111;
    border-radius: 15px;
    box-shadow: 0 0 30px rgba(255,255,255,0.2);
    overflow: hidden;
  }
  canvas {
    display: block;
    width: 100%; height: 100%;
    background: #222;
    border-radius: 15px;
  }
  #ui {
    position: absolute; top: 10px; left: 10px; right: 10px;
    display: flex; justify-content: space-between; align-items: center;
    pointer-events: none;
  }
  #score {
    pointer-events: auto;
    background: rgba(100, 50, 180, 0.8);
    padding: 8px 15px;
    border-radius: 12px;
    font-weight: bold;
    font-size: 1.3rem;
    user-select: none;
  }
  #buttons {
    pointer-events: auto;
  }
  button {
    background: #6a4bcf;
    border: none;
    padding: 8px 14px;
    border-radius: 10px;
    color: white;
    cursor: pointer;
    font-weight: 600;
    font-size: 1rem;
    margin-left: 8px;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  button:hover {
    background-color: #523aa5;
  }
  #menu {
    position: fixed; inset: 0;
    background: linear-gradient(135deg, #44228a, #12002a);
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    color: white;
    text-align: center;
    padding: 2rem;
    user-select: none;
    z-index: 10;
  }
  #menu h1 {
    font-size: 3rem;
    margin-bottom: 0.3rem;
    text-shadow: 0 0 15px #ab7fff;
  }
  #menu p {
    max-width: 350px;
    margin-bottom: 2rem;
    font-size: 1.1rem;
    color: #ccc;
  }
  #menu button {
    font-size: 1.2rem;
    padding: 12px 30px;
  }
  #game-over {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(30,30,30,0.9);
    padding: 2rem 3rem;
    border-radius: 15px;
    font-size: 1.6rem;
    display: none;
    text-align: center;
    user-select: none;
  }
  #game-over button {
    margin-top: 1.5rem;
    padding: 8px 20px;
    font-size: 1rem;
  }
</style>
</head>
<body>

<div id="menu">
  <h1>Dodge Blocks</h1>
  <p>Use arrow keys or A/D to move left and right.<br> Dodge the falling blocks! Difficulty increases over time.</p>
  <button id="start-btn">Start Game</button>
  <button id="music-btn">Music: On</button>
</div>

<div id="game-container" style="display:none;">
  <canvas id="game"></canvas>
  <div id="ui">
    <div id="score">Score: 0</div>
    <div id="buttons">
      <button id="pause-btn">Pause</button>
      <button id="restart-btn">Restart</button>
    </div>
  </div>
  <div id="game-over">
    Game Over!<br />
    <button id="gameover-restart-btn">Restart</button>
  </div>
</div>

<audio id="bg-music" loop src="https://cdn.pixabay.com/download/audio/2021/09/29/audio_7ff6d84fbc.mp3?filename=retro-platformer-loop-11308.mp3"></audio>

<script>
  (() => {
    const menu = document.getElementById('menu');
    const startBtn = document.getElementById('start-btn');
    const musicBtn = document.getElementById('music-btn');
    const gameContainer = document.getElementById('game-container');
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    const scoreEl = document.getElementById('score');
    const pauseBtn = document.getElementById('pause-btn');
    const restartBtn = document.getElementById('restart-btn');
    const gameOverEl = document.getElementById('game-over');
    const gameoverRestartBtn = document.getElementById('gameover-restart-btn');

    const bgMusic = document.getElementById('bg-music');
    bgMusic.volume = 0.25;

    let musicOn = true;
    let paused = false;
    let gameOver = false;

    // Resize canvas to container size
    function resizeCanvas() {
      canvas.width = gameContainer.clientWidth;
      canvas.height = gameContainer.clientHeight;
    }

    window.addEventListener('resize', () => {
      if (gameContainer.style.display !== 'none') {
        resizeCanvas();
        resetPlayer();
      }
    });

    // Player
    const player = {
      w: 50,
      h: 50,
      x: 0,
      y: 0,
      speed: 7,
      dx: 0,
      color: '#f6d365',
    };

    // Blocks array
    let blocks = [];
    const blockW = 50;
    const blockH = 50;
    let blockSpeed = 4;
    let spawnTimer = 0;
    let spawnInterval = 1000; // milliseconds

    // Score
    let score = 0;

    // Controls
    const keys = { left: false, right: false };

    // Reset player position
    function resetPlayer() {
      player.x = (canvas.width - player.w) / 2;
      player.y = canvas.height - player.h - 20;
      player.dx = 0;
      player.speed = 7;
    }

    // Reset game state
    function resetGame() {
      resetPlayer();
      blocks = [];
      blockSpeed = 4;
      spawnInterval = 1000;
      spawnTimer = 0;
      score = 0;
      gameOver = false;
      paused = false;
      updateScore();
      gameOverEl.style.display = 'none';
      pauseBtn.textContent = 'Pause';
      requestAnimationFrame(gameLoop);
    }

    // Update score UI
    function updateScore() {
      scoreEl.textContent = `Score: ${score}`;
    }

    // Spawn a block at random x
    function spawnBlock() {
      const x = Math.random() * (canvas.width - blockW);
      blocks.push({ x, y: -blockH, w: blockW, h: blockH, color: `hsl(${Math.random() * 360}, 70%, 70%)` });
    }

    // Collision detection
    function colliding(a, b) {
      return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
    }

    // Update game objects
    let lastTime = 0;
    function update(time = 0) {
      if (paused || gameOver) return;

      const delta = time - lastTime;
      lastTime = time;

      // Move player
      player.x += player.dx;
      if (player.x < 0) player.x = 0;
      if (player.x + player.w > canvas.width) player.x = canvas.width - player.w;

      // Spawn blocks over time, increasing difficulty
      spawnTimer += delta;
      if (spawnTimer > spawnInterval) {
        // Spawn 1 to 4 blocks depending on difficulty (faster spawn -> more blocks)
        const maxBlocks = Math.min(1 + Math.floor((1000 - spawnInterval) / 200), 4);
        for (let i = 0; i < maxBlocks; i++) spawnBlock();

        spawnTimer = 0;
        // Increase difficulty
        if (spawnInterval > 300) spawnInterval -= 15;
        if (blockSpeed < 12) blockSpeed += 0.2;
        if (player.speed > 3) player.speed -= 0.03;
        // Update player dx based on keys
        if (keys.left && !keys.right) player.dx = -player.speed;
        if (keys.right && !keys.left) player.dx = player.speed;
      }

      // Move blocks and check collision
      for (let i = blocks.length - 1; i >= 0; i--) {
        blocks[i].y += blockSpeed;
        if (blocks[i].y > canvas.height) {
          blocks.splice(i, 1);
          score++;
          updateScore();
          continue;
        }
        if (colliding(player, blocks[i])) {
          gameOver = true;
          gameOverEl.style.display = 'block';
          break;
        }
      }
    }

    // Draw everything
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw player
      ctx.fillStyle = player.color;
      ctx.shadowColor = 'rgba(246,211,101,0.9)';
      ctx.shadowBlur = 20;
      ctx.fillRect(player.x, player.y, player.w, player.h);
      ctx.shadowBlur = 0;

      // Draw blocks
      blocks.forEach(b => {
        ctx.fillStyle = b.color;
        ctx.shadowColor = b.color;
        ctx.shadowBlur = 15;
        ctx.fillRect(b.x, b.y, b.w, b.h);
        ctx.shadowBlur = 0;
      });
    }

    // Game loop
    function gameLoop(time = 0) {
      if (gameOver || paused) {
        draw();
        return;
      }
      update(time);
      draw();
      requestAnimationFrame(gameLoop);
    }

    // Controls
    window.addEventListener('keydown', e => {
      if (e.code === 'ArrowLeft' || e.code === 'KeyA') {
        keys.left = true;
        player.dx = -player.speed;
      }
      if (e.code === 'ArrowRight' || e.code === 'KeyD') {
        keys.right = true;
        player.dx = player.speed;
      }
    });
    window.addEventListener('keyup', e => {
      if (e.code === 'ArrowLeft' || e.code === 'KeyA') {
        keys.left = false;
        if (!keys.right) player.dx = 0;
        else player.dx = player.speed;
      }
      if (e.code === 'ArrowRight' || e.code === 'KeyD') {
        keys.right = false;
        if (!keys.left) player.dx = 0;
        else player.dx = -player.speed;
      }
    });

    // Pause button
    pauseBtn.addEventListener('click', () => {
      if (gameOver) return;
      paused = !paused;
      pauseBtn.textContent = paused ? 'Resume' : 'Pause';
      if (!paused) requestAnimationFrame(gameLoop);
    });

    // Restart buttons
    restartBtn.addEventListener('click', resetGame);
    gameoverRestartBtn.addEventListener('click', resetGame);

    // Start game from menu
    startBtn.addEventListener('click', () => {
      menu.style.display = 'none';
      gameContainer.style.display = 'block';
      resizeCanvas();
      resetGame();
      if (musicOn) bgMusic.play();
    });

    // Music toggle
    musicBtn.addEventListener('click', () => {
      musicOn = !musicOn;
      if (musicOn) {
        bgMusic.play();
        musicBtn.textContent = 'Music: On';
      } else {
        bgMusic.pause();
        musicBtn.textContent = 'Music: Off';
      }
    });

  })();
</script>

</body>
</html>
